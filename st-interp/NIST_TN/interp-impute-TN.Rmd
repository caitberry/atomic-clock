---
title: "Clock data interpolation TN draft"
author: "Thornton"
output:
  word_document:
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
library(tidyverse)
library(MASS)
```


<!--- Open Command Palette: Press F1 or Ctrl + Shift + P to open the command palette.
Run Knit Command: Type rmarkdown: Render and select the desired output format (e.g., HTML, PDF).--->
## Introduction

The purpose of this report is to present a methodological approach for applying imputation and interpolation techniques to clock frequency data. This report is a result of collaborative research into statistical methods for the analysis of high-precision atomic clock data by the Statistical Engineering Division of the Information Technology Laboratory and the Time and Frequency Division of the Physical Measurement Laboratory. 

Because of the high precision in observed data, the reproducible estimation of, say, atomic clock frequency ratios requires careful attention to data processing steps. The idiosyncrasies of processing clock data that we focus on in this report options for the treatment of missing data and for the comparison of low frequency data to high frequency data. We describe the nature of these challenges with supporting examples and we present recommendations for addressing these challenges in a transparent, reproducible manner.      


## Audience

## Collaborators  

## Report Organization 
This note is organized chronologically according to our recommended order of operations. In Section \ref{sec:dataprep}, we discuss necessary data preparation steps, Section \ref{sec:missingdata} covers the handling of missing clock shift data, Section \ref{sec:interp} details techniques for handling multiple, misaligned data sets, and Section \ref{sec:iterate} discusses how to iterate these steps resulting in a coherent final data set for estimation and inference. Section \ref{sec:summary} concludes with a summary and remarks on next steps.   

# Background 

Due to the nature of the machinery involved in generating clock data, the time series will be an irregularly observed one. That is, it is typical that the interval between consecutive measurement times $t_{i}$ and $t_{i+1}$ is non-constant, where $t_{i}$ is a particular MDJ value. This is true even for comb data, though in a much less drastic way. 

For example, most intervals for data from the ErYb comb are around $t_{i+1} - t_{i} = 0.000012$ however some observational gaps can be almost double that size with, say, $t_{j+1} - t_{j} = 0.000022$. In any case, these discrepancies in the time at which the frequency data is collected result in an irregularly sampled time series which poses its own challenges in analysis. Typically, such irregularities are corrected by interpolation which is the topic of a later section.  

Data filtering is not a topic of this manuscript but it is important to note as a part of the data pre-processing stage. Scientists, on an *ad hoc* basis will mark the frequency observations as "good" or "bad". This is indicated with a binary variable $IS_{GOOD} = 0, \text{ if data point is not reliable}$ and $IS_{GOOD} = 1,$ otherwise. 

# Data Preparation 

Initial input: Independent series of clock and comb data
\begin{itemize}
	\item Clock shift files containing variables: MJD, shift, and possibly ISGOOD 
	\item Frequency comb data containing variables: MJD, SDR:frep ErYb, fo ErYb, fb Si ErYb, fb Al ErYb, fb Yb ErYb
\end{itemize}

 Read data into Python

 Define functions to find optical frequencies for each clock with comb equation, these frequencies will become additional variables in the frequency comb data object 

 compute total correction for each clock's shift data 

 Data processing 
\begin{itemize}
  \item filter out all "not good" data. will probably not be any missing values after that but in case there are then go on to imputation step 
	\item change all data variables to type float for high precision computing
	\item find overlapping MJD values for each clock frequency data set 
	\item visualize gaps in the clock frequency data sets 
\end{itemize} 

# Missing Data 

Identify large gaps vs individual or small sequences of missing values of shift data.  

Identify possible/likely causes of missingness 

\begin{itemize}
	\item note MJD indices for large gaps of missing values 
	\item use interpolation techniques (see below) for short sequence of individual missing values 
	\item keep with caution about how this may impact subsequent steps
  \item decide upon initial and final MJD values for analysis  
\end{itemize}


# Frequency Alignment

AFTER data is processed, deciding how to handle missing values, THEN address the likely issue of differences in frequency of observations with interpolation techniques. 

Interpolation - to get clock data to match up with comb time intervals, key difference from imputation step is data is contained w/in a certain range of start/stop MJD values 

\begin{itemize}
	\item numpy.interp and pandas.interpolate, linear 
	\item other options: incorporate randomness, kalman smoothing
  \item lit review 
    \begin{itemize}
    \item including (but not limited to) the problem of transforming a low-frequency series into a high-frequency one
      \begin{itemize}
      \item A Survey of Methods to Interpolate, Distribute and  Extrapolate Time Series (2010) https://www.scirp.org/html/3396.html - Kalman filtering Sec. 6 
      \end{itemize}
    \item 
    \end{itemize} 
\end{itemize}


# Iterating the Data Processing Steps


# Summary and Next Steps 

Calculate clock frequencies by adding together comb frequencies and shift data, scaled by the total correction amount 

End results: clock ratio data to compute offset to compare to previous measurements (may contain missing values?) 


# Misc.


relevant TS properties 

- type of missingness - random (MCAR (e.g. sensor failure), MAR, NMAR), structural deficiency

- trend(s) - autocorrelation plot slowly decreases as the lag increases; Cox-Stuart Test

- seasonality - factors of fixed, known frequencies; autocorrelation plot has larger values for the multiples of the seasonal frequency; Autocorrelation Testing of a certain order 

- noise type

  * white - little/no autocorrelation, stationary TS; autocorrelation plot w/ approx $95\%$ of the spikes within an interval of $\pm 1.96/\sqrt{T}$, where $T$ is the length of the time series; Autocorrelation Testing (i.e. the autocorrelation of the signal must be different from zero only for order zero)

  * flicker/pink 
